# å¤šçº¿ç¨‹ç¬”è®°

## æ ¸å¿ƒæ¦‚å¿µ
- çº¿ç¨‹å°±æ˜¯ç‹¬ç«‹çš„æ‰§è¡Œè·¯å¾„ï¼›
- åœ¨ç¨‹åºè¿è¡Œæ—¶ï¼Œå³ä½¿æ²¡æœ‰è‡ªå·±åˆ›å»ºçº¿ç¨‹ï¼Œåå°ä¹Ÿä¼šæœ‰å¤šä¸ªçº¿ç¨‹ï¼Œå¦‚ä¸»çº¿ç¨‹ï¼Œgcçº¿ç¨‹ï¼›
- main()ç§°ä¸ºä¸»çº¿ç¨‹ï¼Œä¸ºç³»ç»Ÿçš„å…¥å£ï¼Œç”¨äºæ‰§è¡Œæ•´ä¸ªç¨‹åºï¼›
- åœ¨ä¸€ä¸ªè¿›ç¨‹ä¸­ï¼Œå¦‚æœå¼€è¾Ÿäº†å¤šä¸ªçº¿ç¨‹ï¼Œçº¿ç¨‹çš„è¿è¡Œç”±è°ƒåº¦å™¨å®‰æ’è°ƒåº¦ï¼Œè°ƒåº¦å™¨æ˜¯ä¸æ“ä½œç³»ç»Ÿç´§å¯†ç›¸å…³çš„ï¼Œå…ˆåé¡ºåºæ˜¯ä¸èƒ½è®¤ä¸ºå¹²é¢„çš„ï¼›
- å¯¹åŒä¸€ä»½èµ„æºæ“ä½œæ—¶ï¼Œä¼šå­˜åœ¨èµ„æºæŠ¢å¤ºé—®é¢˜ï¼Œéœ€è¦åŠ å…¥å¹¶å‘æ§åˆ¶ï¼›
- çº¿ç¨‹ä¼šå¸¦æ¥é¢å¤–çš„å¼€é”€ï¼Œå¦‚CPUè°ƒåº¦æ—¶é—´ï¼Œå¹¶å‘æ§åˆ¶å¼€é”€ï¼›
- æ¯ä¸ªçº¿ç¨‹åœ¨è‡ªå·±çš„å·¥ä½œå†…å­˜äº¤äº’ï¼Œå†…å­˜æ§åˆ¶ä¸å½“ä¼šé€ æˆæ•°æ®ä¸ä¸€è‡´

## çº¿ç¨‹å®ç°çš„ä¸‰ä¸ªæ–¹å¼

#### ç»§æ‰¿``Thread``ç±»ï¼Œé‡å†™``run``æ–¹æ³•

```java
//åˆ›å»ºçº¿ç¨‹æ–¹å¼ä¸€ï¼šç»§æ‰¿Threadç±»ï¼Œé‡å†™run()æ–¹æ³•ï¼Œè°ƒç”¨start()å¼€å¯çº¿ç¨‹
public class Test01 extends Thread{
	@Override
	public void run() {
		//runæ–¹æ³•çº¿ç¨‹ä½“
		for (int i = 0; i <20; i++) {
			System.out.println("æˆ‘åœ¨çœ‹ä»£ç ");
		}	
	}
	public static void main(String[] args) {
		//mainçº¿ç¨‹ï¼Œä¸»çº¿ç¨‹
		//åˆ›å»ºä¸€ä¸ªçº¿ç¨‹å¯¹è±¡
		Test01 t= new Test01();
        //t.run();     è°ƒç”¨run()æ–¹æ³•ï¼Œæ‰§è¡Œå®Œrunæ–¹æ³•ä½“å†æ‰§è¡Œmainæ–¹æ³•ä½“
		//è°ƒç”¨start()æ–¹æ³•å¼€å¯çº¿ç¨‹     åŒæ—¶æ‰§è¡Œ
		t.start();
		for (int i = 0; i < 2000; i++) {
			System.out.println(â€œæˆ‘åœ¨å­¦å¤šçº¿ç¨‹"+i);
		}
	}
}
```
**çº¿ç¨‹å¼€å¯ä¸ä¸€å®šç«‹å³æ‰§è¡Œï¼Œæœ‰cpuè¿›è¡Œè°ƒåº¦**

### å®ç°``Runnable``æ¥å£
```java
public class TestTread implements Runnable {
	//ç¥¨æ•°
	private int ticketNums = 10;
	@Override
	public void run() {
		while(true){
			if(ticketNums<=0){
				break;
			}		
			//æ¨¡æ‹Ÿå»¶æ—¶
			try {
				Thread.sleep(200);
			} catch (InterruptedException e) {
				e.printStackTrace();
			}		
			System.out.println(Thread.currentThread().getName()+"-->æ‹¿åˆ°äº†ç¬¬"+ticketNums-- +"ç¥¨");
		}
	}
	public static void main(String[] args) {
		TestTread ticket = new TestTread();
		new Thread(ticket,"å°æ˜").start();
		new Thread(ticket,"è€å¸ˆ").start();
		new Thread(ticket,"é»„ç‰›").start();
	}
}
```
> **å°ç»“**ï¼šä»¥ä¸Šä¸¤è€…åŒºåˆ«

- ç»§æ‰¿Threadç±»ï¼š
    - å­ç±»ç»§æ‰¿``Thread``ç±»å…·å¤‡å¤šçº¿ç¨‹èƒ½åŠ›
    - å¯åŠ¨çº¿ç¨‹ï¼šå­ç±»å¯¹è±¡.``start()``
    - ä¸å»ºè®®ä½¿ç”¨ï¼šé¿å…``OOP``å•ç»§æ‰¿å±€é™æ€§

- å®ç°``Runnable``æ¥å£
    - å®ç°``Runnable``æ¥å£å…·å¤‡å¤šçº¿ç¨‹èƒ½åŠ›
    - å¯åŠ¨çº¿ç¨‹ï¼š``new Thread``(å­ç±»å¯¹è±¡).``start()``
    - æ¨èä½¿ç”¨ï¼šé¿å…å•ç»§æ‰¿å±€é™æ€§ï¼Œæ–¹ä¾¿åŒä¸€ä¸ªå¯¹è±¡è¢«å¤šä¸ªçº¿ç¨‹ä½¿

### å®ç°``Callable``æ¥å£

> æ­¥éª¤
- å®ç°Callebleæ¥å£
- é‡å†™call()æ–¹æ³•
- åˆ›å»ºæ‰§è¡ŒæœåŠ¡
  >ExecutorService ser = Executors.newFixedThreadPool(çº¿ç¨‹æ•°);
- æäº¤æ‰§è¡Œ
  >Future<è¿”å›å€¼ç±»å‹> r = ser.submit(çº¿ç¨‹å)ï¼›
- è·å–ç»“æœ
  >ç±»å‹ res=r.get();
- å…³é—­æœåŠ¡
  >ser.shutdownNow();

==æ€»ç»“==ï¼šä¼˜ç‚¹ï¼š1.å¯ä»¥å®šä¹‰è¿”å›å€¼ï¼›2.èƒ½æŠ›å‡ºå¼‚å¸¸
==â€‹ç¼ºç‚¹==ï¼šç›¸æ¯”è€Œè¨€è¾ƒä¸ºéº»çƒ¦

## çº¿ç¨‹åœæ­¢ -- stop()

### çº¿ç¨‹çŠ¶æ€

![1612323610958.png](img/1612323610958.png)

### çº¿ç¨‹åœæ­¢çš„æ–¹æ³•

> æ³¨æ„ç‚¹

- å»ºè®®çº¿ç¨‹æ­£å¸¸åœæ­¢â€”â€”>åˆ©ç”¨æ¬¡æ•°ï¼Œä¸å»ºè®®æ­»å¾ªç¯
- å»ºè®®ä½¿ç”¨æ ‡å¿—ä½â€”â€”>è®¾ç½®ä¸€ä¸ªæ ‡å¿—ä½
- ä¸è¦ä½¿ç”¨``stop``æˆ–è€…``destroy``ç­‰è¿‡æ—¶æˆ–è€…``JDK``ä¸å»ºè®®ä½¿ç”¨çš„æ–¹æ³•

```java
public class TestStop implements Runnable{
    //1.è®¾ç½®ä¸€ä¸ªæ ‡å¿—ä½
    private boolean flag = true;
    @Override
    public void run() {
        int i = 0;
        while(flag){
            System.out.println("run...Thread"+ i++);
        }
    }
    
    //2.è®¾ç½®ä¸€ä¸ªå…¬å¼€çš„æ–¹æ³•åœæ­¢çº¿ç¨‹ï¼Œè½¬æ¢æ ‡å¿—ä½
    public void stop(){
        this.flag = false;
    }

    public static void main(String[] args) {
        TestStop stop = new TestStop();
        new Thread(stop).start();

        for (int i = 0; i < 1000; i++) {
            System.out.println("main"+i);
            if(i==900){
                //è°ƒç”¨stopæ–¹æ³•åˆ‡æ¢æ ‡å¿—ä½ï¼Œè®©çº¿ç¨‹åœæ­¢
                stop.stop();
                System.out.println("çº¿ç¨‹åœæ­¢äº†");
            }
        }
    }
}
```

## çº¿ç¨‹ä¼‘çœ  -- sleep()

- ``sleep``(æ—¶é—´)æŒ‡å®šå½“å‰çº¿ç¨‹é˜»å¡çš„æ¯«ç§’æ•°ï¼›
- ``sleep``å­˜åœ¨å¼‚å¸¸``InterruptedException``ï¼›
- ``sleep``æ—¶é—´è¾¾åˆ°åçº¿ç¨‹è¿›å…¥å°±ç»ªçŠ¶æ€ï¼›
- ``sleep``å¯ä»¥æ¨¡æ‹Ÿç½‘ç»œå»¶æ—¶ï¼Œå€’è®¡æ—¶ç­‰ï¼›
- æ¯ä¸€ä¸ªå¯¹è±¡éƒ½æœ‰ä¸€ä¸ªé”ï¼Œ**``sleep``ä¸ä¼šé‡Šæ”¾é”ã€‚**

> ä¾‹å­1ï¼šæ¨¡æ‹Ÿå»¶æ—¶ï¼šTestThread
æ¨¡æ‹Ÿç½‘ç»œå»¶æ—¶çš„ä½œç”¨ï¼šæ”¾å¤§é—®é¢˜çš„å‘ç”Ÿæ€§

```java
package com.lmr.practice;

import java.text.SimpleDateFormat;
import java.util.Date;

//æ¨¡æ‹Ÿå€’è®¡æ—¶
public class TestSleep2 {

    public static void main(String[] args) {
//        try {
//            tenDown();
//        } catch (InterruptedException e) {
//            e.printStackTrace();
//        }
        //æ‰“å°ç³»ç»Ÿå½“å‰æ—¶é—´
        Date startTime = new Date(System.currentTimeMillis());  //è·å–ç³»ç»Ÿå½“å‰æ—¶é—´
        while(true){
            try {
                Thread.sleep(1000);
                System.out.println(new SimpleDateFormat("HH:mm:ss").format(startTime));
                startTime = new Date(System.currentTimeMillis());  //æ›´æ–°å½“å‰æ—¶é—´
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
        }
    }

    public static void tenDown() throws InterruptedException {
        int num = 10;
        while(true){
            Thread.sleep(1000);
            System.out.println(num--);
            if(num<=0){
                break;
            }
        }
    }
}
```

## çº¿ç¨‹ç¤¼è®© -- yield()

- ç¤¼è®©çº¿ç¨‹ï¼Œè®©å½“å‰æ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹æš‚åœï¼Œä½†ä¸é˜»å¡ï¼›
- å°†çº¿ç¨‹ä»è¿è¡ŒçŠ¶æ€è½¬ä¸ºå°±ç»ªçŠ¶æ€;
- è®©``CPU``é‡æ–°è°ƒåº¦ï¼Œç¤¼è®©ä¸ä¸€å®šæˆåŠŸï¼Œçœ‹``CPU``å¿ƒæƒ…ã€‚

## çº¿ç¨‹å¼ºåˆ¶æ‰§è¡Œ -- join()

- ``join``åˆå¹¶çº¿ç¨‹ï¼Œå¾…æ­¤çº¿ç¨‹æ‰§è¡Œå®Œåï¼Œå†æ‰§è¡Œå…¶å®ƒçº¿ç¨‹ï¼Œå…¶å®ƒçº¿ç¨‹é˜»å¡ï¼›
- å¯ä»¥æƒ³è±¡æˆæ’é˜Ÿ

```java
public class TestJoin implements Runnable{
    @Override
    public void run() {
        for (int i = 0; i < 100; i++) {
            System.out.println("çº¿ç¨‹VIPæ¥äº†"+i);
        }
    }

    public static void main(String[] args) throws InterruptedException {
        TestJoin testJoin = new TestJoin();
        Thread thread = new Thread(testJoin);

        //ä¸»çº¿ç¨‹
        for (int i = 0; i < 1000; i++) {
            if(i == 200){
                thread.start();
                thread.join(); //æ’é˜Ÿ
            }
            System.out.println("main"+i);
            
        }
    }
}
```

## æ–¹æ³•æ€»ç»“

![1612324611314.png](img/1612324611314.png)

## è§‚å¯Ÿçº¿ç¨‹çš„çŠ¶æ€


![1612324643232.png](img/1612324643232.png)

æ ·ä¾‹ï¼š

```java
package cn.livorth.state;

public class TestState {
    public static void main(String[] args) {
        Thread thread  = new Thread(()->{
            for (int i = 0; i < 5; i++) {
                try {
                    Thread.sleep(100);
                } catch (InterruptedException e) {
                    e.printStackTrace();
                }
                System.out.println("******");
            }
        });

        //å¯åŠ¨å‰
        Thread.State state = thread.getState();
        System.out.println(state);//NEW

        //å¯åŠ¨å
        thread.start();
        state = thread.getState();
        System.out.println(state);//RUNABLE

        //é˜»å¡æ—¶ä¸ç»“æŸæ—¶
        while(state != Thread.State.TERMINATED){
            try {
                Thread.sleep(200);
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
            state = thread.getState();
            //TIMED_WAITINGæˆ–è€…TERMINATED
            System.out.println(state);
        }
    }
}
```
æ‰“å°ç»“æœï¼š 

![1612324760898.png](img/1612324760898.png)

## çº¿ç¨‹çš„ä¼˜å…ˆçº§

- ``Java``æä¾›ä¸€ä¸ªçº¿ç¨‹è°ƒåº¦å™¨æ¥ç›‘æ§ç¨‹åºä¸­å¯åŠ¨åè¿›å…¥å°±ç»ªçŠ¶æ€çš„æ‰€æœ‰çº¿ç¨‹ï¼Œçº¿ç¨‹è°ƒåº¦å™¨æŒ‰ç…§ä¼˜å…ˆçº§å†³å®šåº”è¯¥è°ƒåº¦å“ªä¸ªçº¿ç¨‹æ¥æ‰§è¡Œã€‚

- çº¿ç¨‹çš„ä¼˜å…ˆçº§ç”¨æ•°å­—è¡¨ç¤ºï¼ŒèŒƒå›´ä»1~10.
	- ``Thread.MIN_ PRIORITY``= 1;
	- ``Thread.MAX PRIORITY`` = 10;
	- ``Thread.NORM_ PRIORITY``= 5;
- ä½¿ç”¨ä»¥ä¸‹æ–¹å¼è·å–æˆ–æ”¹å˜ä¼˜å…ˆçº§
	- ``getPriority()`` ï¼Œ``setPriority(int xxx)``

**æ³¨æ„ï¼š**

- å…ˆè®¾ç½®ä¼˜å…ˆçº§å†å¯åŠ¨
- ``main``æ–¹æ³•çš„é»˜è®¤ä¼˜å…ˆçº§ä¸º5
- ç†è®ºä¸Šæ¥è¯´ä¼˜å…ˆçº§è¶Šé«˜çš„è¶Šå…ˆæ‰§è¡Œï¼Œå“ªæ€•ä»–``start``æ›´æ™š

## å®ˆæŠ¤çº¿ç¨‹

- çº¿ç¨‹åˆ†ä¸ºç”¨æˆ·çº¿ç¨‹å’Œå®ˆæŠ¤çº¿ç¨‹
- è™šæ‹Ÿæœºå¿…é¡»ç¡®ä¿*ç”¨æˆ·çº¿ç¨‹*æ‰§è¡Œå®Œæ¯• ï¼ˆå¦‚ï¼Œ``main``ï¼‰
- è™šæ‹Ÿæœºä¸ç”¨ç­‰å¾…*å®ˆæŠ¤çº¿ç¨‹*æ‰§è¡Œå®Œæ¯• ï¼ˆå¦‚ï¼Œåå°è®°å½•æ“ä½œæ—¥å¿—ï¼Œç›‘æ§å†…å­˜ï¼Œåƒåœ¾å›æ”¶â€¦â€¦ï¼‰

```java
//ä¸Šå¸å®ˆæŠ¤ä½ 
public class TestDaemon {

    public static void main(String[] args) {
        God god = new God();
        You you = new You();

        Thread thread = new Thread(god);
        thread.setDaemon(true);   //é»˜è®¤falseè¡¨ç¤ºæ˜¯ç”¨æˆ·çº¿ç¨‹ï¼Œæ­£å¸¸çš„çº¿ç¨‹éƒ½æ˜¯ç”¨æˆ·çº¿ç¨‹

        thread.start();  //ä¸Šå¸å®ˆæŠ¤çº¿ç¨‹å¯åŠ¨

        new Thread(you).start();   //ä½  ç”¨æˆ·çº¿ç¨‹å¯åŠ¨
    }
}

//ä¸Šå¸
class God implements Runnable{

    @Override
    public void run() {
        while(true){
            System.out.println("ä¸Šå¸ä¿ä½‘ä½ ");
        }
    }
}

//ä½ 
class You implements Runnable{

    @Override
    public void run() {
        for (int i = 0; i < 36500; i++) {
            System.out.println("ä½ ä¸€ç”Ÿéƒ½å¼€å¿ƒçš„æ´»ç€");
        }
        System.out.println("=====GoodBye World!======");
    }
}
```
ç»“æœï¼š


![1612325654171.png](img/1612325654171.png)

ä¸Šå¸æ˜æ˜æ˜¯ä¸ªæ­»å¾ªç¯ï¼Œä½†æ˜¯è¿›ç¨‹è¿˜æ˜¯ç»“æŸäº†ã€‚

å› ä¸ºè¿™é‡Œå°†ä¸Šå¸çº¿ç¨‹è®¾ç½®ä¸ºäº†å®ˆæŠ¤çº¿ç¨‹ï¼Œè™šæ‹Ÿæœºä¸åŠ ä»¥è€ƒè™‘


## çº¿ç¨‹åŒæ­¥æœºåˆ¶

å¹¶å‘ï¼š**åŒä¸€ä¸ªå¯¹è±¡è¢«å¤šä¸ªçº¿ç¨‹**åŒæ—¶æ“ä½œ ï¼ˆå¦‚ï¼šä¸Šä¸‡äººåŒæ—¶æŠ¢ç¥¨ï¼‰

> å¤„ç†å¤šçº¿ç¨‹é—®é¢˜æ—¶ï¼Œå¤šçº¿ç¨‹è®¿é—®åŒä¸€ä¸ªå¯¹è±¡(å¹¶å‘)ï¼Œå¹¶ä¸”æŸäº›çº¿ç¨‹è¿˜æƒ³ä¿®æ”¹è¿™ä¸ªå¯¹è±¡ã€‚è¿™æ—¶åˆ™éœ€è¦çº¿ç¨‹åŒæ­¥ã€‚
**çº¿ç¨‹åŒæ­¥**å…¶å®æ˜¯ä¸€ç§ç­‰å¾…æœºåˆ¶ï¼Œå¤šä¸ªéœ€è¦åŒæ—¶è®¿é—®æ­¤å¯¹è±¡çš„çº¿ç¨‹è¿›å…¥è¿™ä¸ª**å¯¹è±¡çš„ç­‰å¾…æ± **å½¢æˆé˜Ÿåˆ—ï¼Œç­‰å¾…å‰é¢çš„çº¿ç¨‹ä½¿ç”¨å®Œæ¯•ï¼Œä¸‹ä¸€ä¸ªçº¿ç¨‹å†ä½¿ç”¨ã€‚

> çº¿ç¨‹åŒæ­¥çš„å½¢æˆæ¡ä»¶ï¼š**é˜Ÿåˆ—+é”**

## åŒæ­¥æ–¹æ³•å’ŒåŒæ­¥æ–¹æ³•å¿«

â—†ç”±äºæˆ‘ä»¬å¯ä»¥é€šè¿‡``private``å…³é”®å­—æ¥ä¿è¯æ•°æ®å¯¹è±¡åªèƒ½è¢«æ–¹æ³•è®¿é—®,æ‰€ä»¥æˆ‘ä»¬åªéœ€è¦é’ˆå¯¹æ–¹æ³•æå‡ºä¸€å¥—æœºåˆ¶,è¿™å¥—æœºåˆ¶å°±æ˜¯``synchronized``å…³é”®å­—,å®ƒåŒ…æ‹¬ä¸¤ç§ç”¨æ³•:``synchronized``æ–¹æ³•å’Œ``synchronized``å—

â€‹ åŒæ­¥æ–¹æ³•: ``public synchronized void method(int args) }``

â—†``synchronized``æ–¹æ³•æ§åˆ¶å¯¹â€œå¯¹è±¡â€çš„è®¿é—®,æ¯ä¸ªå¯¹è±¡å¯¹åº”ä¸€æŠŠé”,æ¯ä¸ª``synchronized``æ–¹æ³•éƒ½å¿…é¡»è·å¾—è°ƒç”¨è¯¥æ–¹æ³•çš„å¯¹è±¡çš„é”æ‰èƒ½æ‰§è¡Œ,å¦åˆ™çº¿ç¨‹ä¼šé˜»å¡ï¼Œæ–¹æ³•ä¸€æ—¦æ‰§è¡Œ,å°±ç‹¬å è¯¥é”,ç›´åˆ°è¯¥æ–¹æ³•è¿”å›æ‰é‡Šæ”¾é”,åé¢è¢«é˜»å¡çš„çº¿ç¨‹æ‰èƒ½è·å¾—è¿™ä¸ªé”,ç»§ç»­æ‰§è¡Œã€‚
ç¼ºé™·:è‹¥å°†ä¸€ä¸ªå¤§çš„æ–¹æ³•ç”³æ˜ä¸º``synchronized``å°†ä¼šå½±å“æ•ˆç‡

æ–¹æ³•é‡Œéœ€è¦ä¿®æ”¹çš„å†…å®¹æ‰éœ€è¦é”ï¼Œå¦åˆ™æµªè´¹èµ„æº

â—†åŒæ­¥å—: ``synchronized (Obj){}``

â—†``Obj``ç§°ä¹‹ä¸ºåŒæ­¥ç›‘è§†å™¨

â—†``Obj``å¯ä»¥æ˜¯ä»»ä½•å¯¹è±¡,ä½†æ˜¯æ¨èä½¿ç”¨å…±äº«èµ„æºä½œä¸ºåŒæ­¥ç›‘è§†å™¨

â—†åŒæ­¥æ–¹æ³•ä¸­æ— éœ€æŒ‡å®šåŒæ­¥ç›‘è§†å™¨,å› ä¸ºåŒæ­¥æ–¹æ³•çš„åŒæ­¥ç›‘è§†å™¨å°±æ˜¯``this`` , å°±æ˜¯è¿™ä¸ªå¯¹è±¡æœ¬èº«,æˆ–è€…æ˜¯``class``

â—† åŒæ­¥ç›‘è§†å™¨çš„æ‰§è¡Œè¿‡ç¨‹:

	- ç¬¬ä¸€ä¸ªçº¿ç¨‹è®¿é—®,é”å®šåŒæ­¥ç›‘è§†å™¨,æ‰§è¡Œå…¶ä¸­ä»£ç .
	- ç¬¬äºŒä¸ªçº¿ç¨‹è®¿é—®,å‘ç°åŒæ­¥ç›‘è§†å™¨è¢«é”å®š,æ— æ³•è®¿é—®.
	- ç¬¬ä¸€ä¸ªçº¿ç¨‹è®¿é—®å®Œæ¯•,è§£é”åŒæ­¥ç›‘è§†å™¨
	- ç¬¬äºŒä¸ªçº¿ç¨‹è®¿é—®ï¼Œ å‘ç°åŒæ­¥ç›‘è§†å™¨æ²¡æœ‰é”,ç„¶åé”å®šå¹¶è®¿é—®

> **çº¿ç¨‹ä¸å®‰å…¨çš„å®ä¾‹**

*1.ä¹°ç¥¨*ï¼š
```java
/**
 * @author cy
 * @create 2021-02-03-1:45 ä¸‹åˆ
 * @Description æµ‹è¯•ä¸å®‰å…¨çš„ä¹°ç¥¨
 */
public class TestThreadBuyTic {

    public static void main(String[] args) {
        BuyTicket buyTicket = new BuyTicket();
        new Thread(buyTicket,"è‹¦é€¼çš„æˆ‘").start();
        new Thread(buyTicket,"ç‰›é€¼çš„å¤§å®¶").start();
        new Thread(buyTicket,"å¯æ¶çš„é»„ç‰›").start();
    }

}
class BuyTicket implements Runnable{
    //ç¥¨
    private int ticketNums = 10;
    //å¤–éƒ¨åœæ­¢æ–¹å¼
    boolean flag = true;

    @Override
    @SneakyThrows
    public void run() {
        //ä¹°ç¥¨
        while (true){
            buy();
        }
    }

    public  void buy() throws InterruptedException {
        //åˆ¤æ–­æ˜¯å¦æœ‰ç¥¨
        if(ticketNums <= 0){
            return;
        }
        //æ¨¡æ‹Ÿå»¶æ—¶
            Thread.sleep(100);
        System.out.println(Thread.currentThread().getName()+"æ‹¿åˆ°äº†"+ticketNums--+"ç¥¨");
    }
}
```

æµ‹è¯•ç»“æœï¼š
ç»“æœå‡ºç°äº†ï¼ˆ-1ï¼‰: è¿™æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„
![1612332017024.png](img/1612332017024.png)

*2.é“¶è¡Œå–é’±*

```java
/**
 * @author cy
 * @create 2021-02-03-2:03 ä¸‹åˆ
 * @Description çº¿ç¨‹é“¶è¡Œå–é’±ä¸å®‰å…¨å®ä¾‹
 */
public class TestThreadBank {
    public static void main(String[] args) {
        Account account = new Account(100, "ç»“å©šåŸºé‡‘");

        Drawing lg = new Drawing(account, 50, "è€å…¬");
        Drawing lp = new Drawing(account, 100, "è€å©†");

        lg.start();
        lp.start();


    }
}

//è´¦æˆ·
class Account{
    //ä½™é¢
    int money;
    //å¡å
    String name;

    public Account(int money, String name) {
        this.money = money;
        this.name = name;
    }
}
//é“¶è¡Œ
class Drawing extends Thread{

    //è´¦æˆ·
    Account account;
    //å–äº†å¤šå°‘é’±
    int drawingMoney;
    //ç°åœ¨æ‰‹é‡Œæœ‰å¤šå°‘é’±
    int nowMoney;

    public Drawing(Account account, int drawingMoney,String name) {
        super(name);
        this.account = account;
        this.drawingMoney = drawingMoney;
    }
    //å–é’±
    @Override
    public void run() {
        //åˆ¤æ–­æ‰‹é‡Œæœ‰æ²¡æœ‰é’±
        if(account.money - drawingMoney < 0){
            System.out.println(Thread.currentThread().getName()+"é’±ä¸å¤Ÿ");
        }
        //sleep å¯ä»¥æ”¾å¤§é—®é¢˜çš„å‘ç”Ÿæ€§
        try {
            Thread.sleep(1000);
        } catch (InterruptedException e) {
            e.printStackTrace();
        }
        //å¡å†…ä½™é¢=ä½™é¢-ä½ å–çš„é’±
        account.money = account.money - drawingMoney;
        //ä½ æ‰‹é‡Œçš„é’±
        nowMoney = nowMoney + drawingMoney;
        System.out.println(account.name+"ä½™é¢ä¸º"+account.money);
        //è¿™ä¸¤ä¸ªæ“ä½œç­‰ä»·
        //System.out.println(this.getName()+Thread.currentThread().getName());
        System.out.println(this.getName()+"æ‰‹é‡Œçš„é’±"+nowMoney);

    }
}
```

ç»“æœæˆªå›¾ï¼šå­˜æ¬¾å‡ºç°äº†è´Ÿæ•°

![1612333110477.png](img/1612333110477.png)

> æŠŠä¸å®‰å…¨çš„æ”¹æˆå®‰å…¨çš„

ç¬¬ä¸€ä¸ªè´­ä¹°ç¥¨çš„å®ä¾‹ä¸­ï¼Œbuy()æ–¹æ³•æ·»åŠ ``synchronized``ï¼Œè¿™å«**åŒæ­¥æ–¹æ³•**
```java
//åŒæ­¥æ–¹æ³•ï¼Œé”çš„æ˜¯this
    private synchronized void buy() throws InterruptedException{
        //åˆ¤æ–­æ˜¯å¦æœ‰ç¥¨
        if(ticketNums<=0)
        {
            return;
        }
        //æ¨¡æ‹Ÿå»¶æ—¶
        Thread.sleep(100);
        //ä¹°ç¥¨
        System.out.println(Thread.currentThread().getName()+"æ‹¿åˆ°äº†"+ticketNums--+"ç¥¨");
    }
```
å°±å†ä¹Ÿä¸ä¼šå‡ºç°é—®é¢˜äº†ï¼š
![1612333468564.png](img/1612333468564.png)

<hr>ã€
ç¬¬äºŒä¸ªå–é’±å®ä¾‹ï¼Œé‡‡ç”¨**åŒæ­¥å—**æ¼”ç¤º:

```java
 //å–é’±
    @Override
    public void run() {
        synchronized(account)
        {
            //åˆ¤æ–­æœ‰æ²¡æœ‰é’±
            if(account.money-drawingMoney<0)
            {
                System.out.println(Thread.currentThread().getName()+"é’±ä¸å¤Ÿ");
                return;
            }
            //sleepå¯ä»¥æ”¾å¤§é—®é¢˜çš„å‘ç”Ÿæ€§
            try {
                Thread.sleep(1000);
            }catch(Exception e)
            {
                e.printStackTrace();
            }
            //å¡å†…ä½™é¢=ä½™é¢-ä½ å–çš„é’±
            account.money = account.money-drawingMoney;
            //ä½ æ‰‹é‡Œçš„é’±
            nowMoney = nowMoney + drawingMoney;
            System.out.println(account.name+"ä½™é¢ä¸º"+account.money);
           
            //è¿™ä¸¤ä¸ªæ“ä½œç­‰ä»·
            //System.out.println(this.getName()+Thread.currentThread().getName());
            System.out.println(this.getName()+"æ‰‹é‡Œçš„é’±"+nowMoney);
       
        }
    }
```
ç»“æœï¼š

![1612333886911.png](img/1612333886911.png)


## æ­»é”

**è§£é‡Š:**

å¤šä¸ªçº¿ç¨‹å„è‡ªå æœ‰ä¸€äº›å…±äº«èµ„æº,**å¹¶ä¸”äº’ç›¸ç­‰å¾…å…¶ä»–çº¿ç¨‹å æœ‰çš„èµ„æº**æ‰èƒ½è¿è¡Œ,è€Œå¯¼è‡´ä¸¤ä¸ªæˆ–è€…å¤šä¸ªçº¿ç¨‹éƒ½åœ¨ç­‰å¾…å¯¹æ–¹é‡Šæ”¾èµ„æº,éƒ½åœæ­¢æ‰§è¡Œçš„æƒ…å½¢. æŸä¸€ä¸ªåŒæ­¥å—åŒæ—¶æ‹¥æœ‰**ä¸¤ä¸ªä»¥ä¸Šå¯¹è±¡çš„é”**æ—¶,å°±å¯èƒ½ä¼šå‘ç”Ÿâ€œæ­»é”â€çš„é—®é¢˜.

### Lockï¼ˆé”ğŸ”’ï¼‰

é€šè¿‡æ˜¾ç¤ºå®šä¹‰åŒæ­¥é”å¯¹è±¡ï¼ˆLockï¼‰æ¥å®ç°åŒæ­¥

**``ReentrantLock``ç±»å®ç°äº†``Lock``æ¥å£ï¼Œå®ƒæ‹¥æœ‰ä¸``synchronized``ç›¸åŒçš„å¹¶å‘æ€§å’Œå†…å­˜è¯­ä¹‰ï¼Œåœ¨å®ç°çº¿ç¨‹å®‰å…¨çš„æ§åˆ¶ä¸­ï¼Œæ¯”è¾ƒå¸¸ç”¨çš„æ˜¯``ReentrantLock``,å¯ä»¥æ˜¾å¼åŠ é”ã€é‡Šæ”¾é”ã€‚**

åŠ é”ï¼š``lock.lock()``

è§£é”ï¼š``lock.unlock()``

æ¼”ç¤ºä»£ç :

```java
public class TestLock {

    public static void main(String[] args) {
        TestLock2 testLock = new TestLock2();
        new Thread(testLock, "A").start();
        new Thread(testLock, "B").start();
        new Thread(testLock, "C").start();
    }
}

class TestLock2 implements Runnable{
    int count = 1000;
    //å®šä¹‰locké”
    private final ReentrantLock lock = new ReentrantLock();
    @Override
    public void run() {
        try {
            Thread.sleep(1000);
        } catch (InterruptedException e) {
            e.printStackTrace();
        }
        while(true)
        {
            try {
                //è¿›å…¥åŠ é”çŠ¶æ€
                lock.lock();
                if(count > 0)
                    System.out.println(Thread.currentThread().getName() + "---" +count--);
                else
                    break;
            }
            finally {
                //è§£é”
                lock.unlock();
            }
        }
    }
}
```
==è¯´æ˜==

åœ¨ä¸åŠ é”çš„æƒ…å†µä¸‹ï¼ŒABCå¯èƒ½ä¼šåŒæ—¶æ“ä½œåˆ°countï¼Œå¯¼è‡´æ•°æ®ç´Šä¹±

åœ¨åŠ äº†é”ä¹‹åï¼ŒABCæ’é˜Ÿæ“ä½œ

## çº¿ç¨‹åä½œ

### ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å¼
ç”Ÿäº§è€…ä¸æ¶ˆè´¹è€…å…±äº«ä¸€ä¸ªèµ„æºï¼ŒåŒæ—¶ç”Ÿäº§è€…ä¸æ¶ˆè´¹è€…ç›¸äº’ä¾èµ–äº’ä¸ºæ¡ä»¶

	- ç”Ÿäº§è€…è®¿é—®ä»“åº“ï¼Œå¾€é‡Œé¢æ”¾ï¼›æ¶ˆè´¹è€…ä¹Ÿè¦è®¿é—®ï¼Œä½†æ˜¯åªæ‹¿

ä¸»è¦æ˜¯ç”¨ä»¥ä¸‹æ–¹æ³•è¾¾åˆ°é€šä¿¡çš„æ•ˆæœï¼š
- ``wait()``ï¼šå…ˆé‡Šæ”¾èµ„æºï¼Œå¹¶å¼€å§‹ç­‰å¾…
- ``wait(long timeout)``ï¼šé‡Šæ”¾èµ„æºç­‰å¾…timeoutç§’
- ``notify()``ï¼šå”¤é†’ä¸€ä¸ªå¤„äºç­‰å¾…çŠ¶æ€çš„çº¿ç¨‹
- ``notifyAll()``ï¼šå”¤é†’åŒä¸€ä¸ªå¯¹è±¡ä¸Šæ‰€æœ‰è°ƒç”¨äº†wait()æ–¹æ³•çš„çº¿ç¨‹ï¼Œä¼˜å…ˆçº§é«˜çš„ä¼˜å…ˆè°ƒåº¦

è§£å†³æ–¹å¼ï¼š

1. ç®¡ç¨‹æ³•
   
	è®¾ç½®ä¸€ä¸ªç¼“å†²åŒºï¼Œç”¨æˆ·æš‚å­˜æ•°æ®
	
	ä»£ç æ¼”ç¤ºï¼š

	```java
	//ç®¡ç¨‹æ³•è§£å†³
	public class TestPC {
		public static void main(String[] args) {
			//åˆ›å»ºç¼“å†²åŒº
			SynContainer container = new  SynContainer();

			//åŒçº¿ç¨‹
			new Producer(container).start();
			new Consumer(container).start();
		}
	}

	//ç”Ÿäº§è€…
	class Producer extends Thread{
		SynContainer container;

		public Producer(SynContainer container) {
			this.container = container;
		}

		@Override
		public void run() {
			for (int i = 0; i < 100; i++) {
				System.out.println("ç”Ÿäº§äº†ç¬¬" + i + "ä»¶äº§å“");
				container.push(new Products(i));
			}
		}
	}

	//æ¶ˆè´¹è€…
	class Consumer extends Thread{
		SynContainer container;

		public Consumer(SynContainer container) {
			this.container = container;
		}

		@Override
		public void run() {
			for (int i = 0; i < 100; i++) {
				System.out.println("æ¶ˆè´¹äº†ç¬¬" + container.pop().id + "ä»¶äº§å“");
			}
		}
	}

	//äº§å“
	class Products{
		int id;

		public Products(int id) {
			this.id = id;
		}
	}

	//ç¼“å†²åŒº
	class SynContainer{
		Queue<Products> queue = new LinkedList<Products>();
		int count = 0;
		int size = 10;

		//ç”Ÿäº§è€…æ”¾å…¥äº§å“
		public synchronized void push(Products product)
		{
			//å®¹å™¨æ»¡ï¼Œç­‰å¾…æ¶ˆè´¹è€…æ¶ˆè´¹
			if(count == size)
			{
				try {
					this.wait();
				} catch (InterruptedException e) {
					e.printStackTrace();
				}
			}

			//æ²¡æ»¡ï¼Œæˆ‘ä»¬åˆ™éœ€è¦å­˜å…¥æˆå“,å¹¶å”¤é†’æ¶ˆè´¹è€…
			count++;
			queue.offer(product);
			this.notifyAll();
		}

		//æ¶ˆè´¹è€…æ¶ˆè´¹äº§å“
		public synchronized Products pop()
		{
			//å®¹å™¨ä¸ºç©ºï¼Œç­‰å¾…ç”Ÿäº§è€…ç”Ÿäº§
			if (count == 0) {
				try {
					this.wait();
				} catch (InterruptedException e) {
					e.printStackTrace();
				}
			}

			//å®¹å™¨æœ‰å‰©ï¼Œå–å‡ºç‰©å“ï¼Œå¹¶å‘Šè¯‰ç”Ÿäº§è€…å¯ä»¥ç”Ÿäº§äº†
			count--;
			Products productPoll = queue.poll();
			this.notifyAll();
			return productPoll;
		}
	}
	```
2. ä¿¡å·ç¯æ³•

	è®¾ç½®ä¸€ä¸ªæ ‡è®°ä½ï¼ˆç±»ä¼¼äºå®¹é‡ä¸º1çš„ç®¡ç¨‹æ³•ï¼‰
	```java
	//ä¿¡å·ç¯æ³•è§£å†³
	public class TestPC2 {
		public static void main(String[] args) {
			//åˆ›å»ºç¼“å†²åŒº
			TheProduct theProduct = new  TheProduct();

			//åŒçº¿ç¨‹
			new Producers(theProduct).start();
			new Consumers(theProduct).start();
		}
	}

	//ç”Ÿäº§è€…
	class Producers extends Thread{
		TheProduct theProduct;

		public Producers(TheProduct theProduct) {
			this.theProduct = theProduct;
		}

		@Override
		public void run() {
			for (int i = 0; i < 10; i++) {
				theProduct.push("äº§å“" + i);
			}
		}
	}

	//æ¶ˆè´¹è€…
	class Consumers extends Thread{
		TheProduct theProduct;

		public Consumers(TheProduct container) {
			this.theProduct = container;
		}

		@Override
		public void run() {
			for (int i = 0; i < 10; i++) {
				theProduct.pop();
			}
		}
	}

	//äº§å“
	class TheProduct{
		boolean flag = false;
		String product;
		//ç”Ÿäº§è€…ç”Ÿäº§ï¼Œæ¶ˆè´¹è€…ç­‰å¾…
		public synchronized void push(String product)
		{
			if(flag)
			{
				try {
					this.wait();
				} catch (InterruptedException e) {
					e.printStackTrace();
				}
			}

			System.out.println("ç”Ÿäº§è€…ç”Ÿäº§äº†" + product);
			this.product = product;
			this.flag = !this.flag;
			this.notifyAll();

		}

		//æ¶ˆè´¹è€…æ¶ˆè´¹ï¼Œç”Ÿäº§è€…ç­‰å¾…
		public synchronized void pop()
		{
			if(!flag)
			{
				try {
					this.wait();
				} catch (InterruptedException e) {
					e.printStackTrace();
				}
			}

			System.out.println("æ¶ˆè´¹è€…æ¶ˆè´¹äº†" + product);
			this.flag = !this.flag;
			this.notifyAll();
		}
	}
	```

## çº¿ç¨‹æ± 

- èƒŒæ™¯:ç»å¸¸åˆ›å»ºå’Œé”€æ¯ã€ä½¿ç”¨é‡ç‰¹åˆ«å¤§çš„èµ„æºï¼Œæ¯”å¦‚å¹¶å‘æƒ…å†µä¸‹çš„çº¿ç¨‹ï¼Œå¯¹æ€§èƒ½å½±å“å¾ˆå¤§
- æ€è·¯:æå‰åˆ›å»ºå¥½å¤šä¸ªçº¿ç¨‹ï¼Œæ”¾å…¥çº¿ç¨‹æ± ä¸­ï¼Œä½¿ç”¨æ—¶ç›´æ¥è·å–,ä½¿ç”¨å®Œæ”¾å›æ± ä¸­ï¼Œå¯ä»¥é¿å…é¢‘ç¹åˆ›å»ºé”€æ¯ã€å®ç°é‡å¤åˆ©ç”¨ã€‚ç±»ä¼¼ç”Ÿæ´»ä¸­çš„å…¬å…±äº¤é€šå·¥å…·
- å¥½å¤„:
	- æé«˜å“åº”é€Ÿåº¦(å‡å°‘äº†åˆ›å»ºæ–°çº¿ç¨‹çš„æ—¶é—´)
	- é™ä½èµ„æºæ¶ˆè€—(é‡å¤åˆ©ç”¨çº¿ç¨‹æ± ä¸­çº¿ç¨‹ï¼Œä¸éœ€è¦æ¯æ¬¡éƒ½åˆ›å»º)
	- ä¾¿äºçº¿ç¨‹ç®¡ç†
		- ``corePoolSize``:æ ¸å¿ƒæ± çš„å¤§å°
		- ``maximumPoolSize``: æœ€å¤§çº¿ç¨‹æ•°
		- ``keepAliveTime``: çº¿ç¨‹æ²¡æœ‰ä»»åŠ¡æ—¶æœ€å¤šä¿æŒå¤šé•¿æ—¶é—´åä¼šç»ˆæ­¢

